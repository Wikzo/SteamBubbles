<!DOCTYPE html>
<meta http-equiv="content-type" content="text/html; charset=UTF8">

<head>
    <title>SteamBubbles</title>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
    <meta charset="utf-8">
    <style>

        text {
            font: 20px sans-serif;
        }

        text {
            font: 60px sans-serif;
            color: white;
            text-shadow:
            -1px -1px 0 #000,
            1px -1px 0 #000,
            -1px 1px 0 #000,
            1px 1px 0 #000;
        }

        text.parent {
            fill: #ff7f0e;
        }

        circle {
            stroke: #999;

            pointer-events: all;
        }

        circle.parent {
            fill: #ff7f0e;
            fill-opacity: 1;
            stroke: #ff7f0e;
            stroke-width: 5px;
        }

        circle.parent:hover {
            stroke: #ff7f0e;
            stroke-width: 10px;
        }

        circle.child {
            pointer-events: none;
        }

    </style>
</head>

<body>


<h1>SteamBubbles</h1>
<button onclick="Reload()">Show fewer games</button>


<br class="filter_options">

<p><b>Genres Filters:</b></p>


<table style="width:100%">
    <tr>
        <td><input class="filter_button" id="icons_button" type="checkbox">Display Icons</input></td>

        <td><input class="filter_button" id="action_button" type="checkbox" checked>Action</input>
            </br><img src="http://icons.iconarchive.com/icons/icons8/ios7/128/Military-Firing-Gun-icon.png" height="42"
                      width="42"></td>
        <td><input class="filter_button" id="adventure_button" type="checkbox" checked>Adventure</input></br>
            <img src="http://icons.iconarchive.com/icons/icons8/ios7/128/Military-Firing-Gun-icon.png" height="42"
                 width="42"></td>
        <td><input class="filter_button" id="casual_button" type="checkbox" checked>Casual</input></br>
            <img src="http://icons.iconarchive.com/icons/icons8/ios7/128/Military-Firing-Gun-icon.png" height="42"
                 width="42"></td>
        <td><input class="filter_button" id="indie_button" type="checkbox" checked>Indie</input></br>
            <img src="http://icons.iconarchive.com/icons/icons8/ios7/128/Military-Firing-Gun-icon.png" height="42"
                 width="42"></td>
        <td><input class="filter_button" id="mmo_button" type="checkbox" checked>MMO</input></br>
            <img src="http://icons.iconarchive.com/icons/icons8/ios7/128/Military-Firing-Gun-icon.png" height="42"
                 width="42"></td>
        <td><input class="filter_button" id="racing_button" type="checkbox" checked>Racing</input></br>
            <img src="http://icons.iconarchive.com/icons/icons8/ios7/128/Military-Firing-Gun-icon.png" height="42"
                 width="42"></td>
        <td><input class="filter_button" id="rpg_button" type="checkbox" checked>RPG</input></br>
            <img src="http://icons.iconarchive.com/icons/icons8/ios7/128/Military-Firing-Gun-icon.png" height="42"
                 width="42"></td>
        <td><input class="filter_button" id="simulation_button" type="checkbox" checked>Simulation</input></br>
            <img src="http://icons.iconarchive.com/icons/icons8/ios7/128/Military-Firing-Gun-icon.png" height="42"
                 width="42"></td>
        <td><input class="filter_button" id="sports_button" type="checkbox" checked>Sports</input></br>
            <img src="http://icons.iconarchive.com/icons/icons8/ios7/128/Military-Firing-Gun-icon.png" height="42"
                 width="42"></td>
        <td><input class="filter_button" id="strategy_button" type="checkbox" checked>Strategy</input></br>
            <img src="http://icons.iconarchive.com/icons/icons8/ios7/128/Military-Firing-Gun-icon.png" height="42"
                 width="42"></td>


    </tr>
</table>

</br>
</br>

</div>

<script src="//d3js.org/d3.v3.min.js"></script>


<script type="text/javascript">

    // input fields and more:
    // http://www.d3noob.org/2014/04/using-html-inputs-with-d3js.html
    // https://gist.github.com/bjtucker/fd3aa6e64d565962f1c1

    // when the input range changes update the circle
    d3.select("#nRadius").on("input", function () {
        //update(+this.value);
        console.log(this.value);

        minimumPlayersLastTwoWeekThreshold = this.value;
    });

    var minimumPlayersLastTwoWeekThreshold = 5000;

    // access external JSON data_old in Chrome:
    // https://stackoverflow.com/questions/20035101/no-access-control-allow-origin-header-is-present-on-the-requested-resource

    var action = {name: "ACTION", url: "http://steamspy.com/api.php?request=genre&genre=Action"};
    var adventure = {name: "ADVENTURE", url: "http://steamspy.com/api.php?request=genre&genre=Adventure"};
    var casual = {name: "CASUAL", url: "http://steamspy.com/api.php?request=genre&genre=Casual"};
    var indie = {name: "INDIE", url: "http://steamspy.com/api.php?request=genre&genre=Indie"};
    var mmo = {name: "MMO", url: "http://steamspy.com/api.php?request=genre&genre=Massively"};
    var racing = {name: "RACING", url: "http://steamspy.com/api.php?request=genre&genre=Racing"};
    var rpg = {name: "RPG", url: "http://steamspy.com/api.php?request=genre&genre=RPG"};
    var simulation = {name: "SIMULATION", url: "http://steamspy.com/api.php?request=genre&genre=Simulation"};
    var sports = {name: "SPORTS", url: "http://steamspy.com/api.php?request=genre&genre=Sports"};
    var strategy = {name: "STRATEGY", url: "http://steamspy.com/api.php?request=genre&genre=Strategy"};

    var URLs = [action, adventure, casual, indie, mmo, racing, rpg, simulation, sports, strategy];

    var actionData = {"children": []};
    var adventureData = {"children": []};
    var casualData = {"children": []};
    var indieData = {"children": []};
    var mmoData = {"children": []};
    var racingData = {"children": []};
    var rpgData = {"children": []};
    var simulationData = {"children": []};
    var sportsData = {"children": []};
    var strategyData = {"children": []};

    var useLocalFiles = true;
    var zoomLevel = 0;
    var superRoot;

    var actionColor = '#9b2f3a';
    var adventureColor = '#576c5e';
    var casualColor = '#dac5a8';
    var indieColor = '#93794d';
    var mmoColor = '#1a3f75';
    var racingColor = '#093640';
    var rpgColor = '#04b2d9';
    var simulationColor = '#f28f38';
    var sportsColor = '#f2be5c';
    var strategyColor = '#f2766b';
    var defaultColor = "#ffffff";
    var notSelectedColor = "#000000";

    var currentActionColor = '#9b2f3a';
    var currentAdventureColor = '#576c5e';
    var currentCasualColor = '#dac5a8';
    var currentIndieColor = '#93794d';
    var currentMmoColor = '#1a3f75';
    var currentRacingColor = '#093640';
    var currentRpgColor = '#04b2d9';
    var currentSimulationColor = '#f28f38';
    var currentSportsColor = '#f2be5c';
    var currentStrategyColor = '#f2766b';

    var actionIcon = "http://icons.iconarchive.com/icons/icons8/ios7/128/Military-Firing-Gun-icon.png";
    var adventureIcon = "http://icons.iconarchive.com/icons/icons8/ios7/128/Cinema-Adventures-icon.png";
    var casualIcon = "http://icons.iconarchive.com/icons/double-j-design/ravenna-3d/128/Poker-icon.png";
    var indieIcon = "http://icons.iconarchive.com/icons/designcontest/vintage/128/Pixel-Art-icon.png";
    var mmoIcon = "http://icons.iconarchive.com/icons/hopstarter/sleek-xp-basic/128/World-icon.png";
    var racingIcon = "http://icons.iconarchive.com/icons/bartkowalski/1960-matchbox-cars/128/BRM-Racing-Car-icon.png";
    var rpgIcon = "http://icons.iconarchive.com/icons/chrisl21/minecraft/128/Iron-Sword-icon.png";
    var simulationIcon = "http://icons.iconarchive.com/icons/awicons/vista-artistic/128/2-Hot-Train-icon.png";
    var sportsIcon = "http://icons.iconarchive.com/icons/custom-icon-design/flatastic-10/128/Sport-american-football-icon.png";
    var strategyIcon = "http://icons.iconarchive.com/icons/aha-soft/free-large-boss/128/Army-Officer-icon.png"

    var showIcons = false;

    var showAction = true;
    var showCasual = true;
    var showIndie = true;
    var showMMO = true;
    var showRacing = true;
    var showRPG = true;
    var showSimulation = true;
    var showSports = true;
    var showStrategy = true;

    var adventureColor = '#576c5e';
    var casualColor = '#dac5a8';
    var indieColor = '#93794d';
    var mmoColor = '#1a3f75';
    var racingColor = '#093640';
    var rpgColor = '#04b2d9';
    var simulationColor = '#f28f38';
    var sportsColor = '#f2be5c';
    var strategyColor = '#f2766b';
    var defaultColor = "#ffffff";
    var notSelectedColor = "#5f5f5f";

    /*var arr = new Array();
     // or var arr = [];
     arr.push('value1');
     arr.push('value2');*/

    d3.json("https://steamspy.com/api.php?request=genre&genre=Strategy", function(error, json) {
        if (error)
            Start(true);
        else
            Start(false);
    });

    //Start();


    function Start(useLocalData) {

        useLocalFiles = useLocalData;

        if (useLocalFiles == true)
            console.log("Starting, using local data");
        else
            console.log("Starting, using online data");


        loadingIndex = 0;

        if (useLocalFiles == true) {
            action.url = "action.json";
            adventure.url = "adventure.json";
            casual.url = "casual.json";
            indie.url = "indie.json";
            mmo.url = "massively.json";
            racing.url = "racing.json";
            rpg.url = "rpg.json";
            simulation.url = "simulation.json";
            sports.url = "sports.json";
            strategy.url = "strategy.json";

        }
        LoadDataFromSteamSpy();
    }


    function Reload() {
        loadingIndex = 0;
        circles = null;
        minimumPlayersLastTwoWeekThreshold = minimumPlayersLastTwoWeekThreshold * 2;
        Start();
    }
    var loadingIndex = 0;
    function LoadDataFromSteamSpy() {
        //console.log("loading");
        d3.json(URLs[loadingIndex].url, function (error, data) {

                var workAsArray = []; // This will be the resulting array
            for (var key in data) {
                var entry = data[key]; // This will be each of the three graded things
                entry.id = key; // e.g. "id": "assessment1"

                //if (entry.players_2weeks > minimumPlayersLastTwoWeekThreshold)
                if ((entry.average_forever / 60).toFixed(2) > 5)
                {
                    workAsArray.push(entry)

                }
            }

            if (loadingIndex == 0) {
                actionData.children = workAsArray;
                actionData.Category = URLs[loadingIndex].name;
            }

            else if (loadingIndex == 1) {
                adventureData.children = workAsArray;
                adventureData.Category = URLs[loadingIndex].name;
            }
            else if (loadingIndex == 2) {
                casualData.children = workAsArray;
                casualData.Category = URLs[loadingIndex].name;
            }
            else if (loadingIndex == 3) {
                indieData.children = workAsArray;
                indieData.Category = URLs[loadingIndex].name;
            }
            else if (loadingIndex == 4) {
                mmoData.children = workAsArray;
                mmoData.Category = URLs[loadingIndex].name;
            }
            else if (loadingIndex == 5) {
                racingData.children = workAsArray;
                racingData.Category = URLs[loadingIndex].name;
            }
            else if (loadingIndex == 6) {
                rpgData.children = workAsArray;
                rpgData.Category = URLs[loadingIndex].name;
            }
            else if (loadingIndex == 7) {
                simulationData.children = workAsArray;
                simulationData.Category = URLs[loadingIndex].name;
            }
            else if (loadingIndex == 8) {
                sportsData.children = workAsArray;
                sportsData.Category = URLs[loadingIndex].name;
            }
            else if (loadingIndex == 9) {
                strategyData.children = workAsArray;
                strategyData.Category = URLs[loadingIndex].name;
            }

            data.Category = URLs[loadingIndex].name;

            DoneLoading(URLs[loadingIndex]);
        });
    }

    function DoneLoading(dataToStore) {
        console.log(URLs[loadingIndex].name + " loaded");
        loadingIndex++;

        if (loadingIndex < URLs.length)
            LoadDataFromSteamSpy();
        else
            CheckIfAllDone();
    }


    var circles;
    function CheckIfAllDone() {
        circles = DrawBubbles();

        HighlightCategories();
    }

    var tooltip = d3.select("body")
            .append("div")
            .style("position", "absolute")
            .style("z-index", "10")
            .style("visibility", "hidden")
            .style("color", "white")
            .style("padding", "8px")
            .style("background-color", "rgba(0, 0, 0, 0.75)")
            .style("border-radius", "6px")
            .style("font", "14px sans-serif")
            .text("tooltip");

    var w = window.innerWidth,
            h = window.innerWidth,
            r = window.innerWidth,
            x = d3.scale.linear().range([0, r]),
            y = d3.scale.linear().range([0, r]),
            node,
            root;

    var pack = d3.layout.pack()
            .size([r, r]).sort(function (a, b) {
                return a.score_rank - b.score_rank;
            })
            .padding([2])
            .value(function (d) {
                return d.score_rank;
            });

    var vis = d3.select("body").insert("svg:svg", "h2")
            .attr("width", w)
            .attr("height", h)
            .append("svg:g")
            .attr("transform", "translate(" + (w - r) / 2 + "," + (h - r) / 2 + ")");

    function DrawBubbles() {



            var games1 = {
                "name": "GAMES_1",
                "children": [actionData, adventureData, casualData, indieData, mmoData, racingData, rpgData, simulationData, sportsData, strategyData]
            };
        node = root = games1;

        root = games1;


            var b100 = {"children": []};
            var b90 = {"children": []};
            var b80 = {"children": []};
            var b70 = {"children": []};
            var b60 = {"children": []};
            var b50 = {"children": []};
            var b40 = {"children": []};
            var b30 = {"children": []};
            var b20 = {"children": []};
            var b10 = {"children": []};

            b100.IntervalName = "91-100%";
            b90.IntervalName = "81-90%";
            b80.IntervalName = "71-80%";
            b70.IntervalName = "61-70%";
            b60.IntervalName = "51-60%";
            b50.IntervalName = "41-50%";
            b40.IntervalName = "31-40%";
            b30.IntervalName = "21-30%";
            b20.IntervalName = "11-20%";
            b10.IntervalName = "0-10%";

            var gameNode = {"name": "GAMES_2", "children": [b100, b90, b80, b70, b60, b50, b40, b30, b20, b10]};

            superRoot = gameNode;

            // get all children's score rank
            root.children.forEach(function (d) {


                if (d.children) {

                    d.children.forEach(function (game) {
                        game.Category = d.Category;

                        if (game.score_rank > 90)
                            gameNode.children[0].children.push(game);
                        else if (game.score_rank > 80)
                            gameNode.children[1].children.push(game);
                        else if (game.score_rank > 70)
                            gameNode.children[2].children.push(game);
                        else if (game.score_rank > 50)
                            gameNode.children[4].children.push(game);
                        else if (game.score_rank > 40)
                            gameNode.children[5].children.push(game);
                        else if (game.score_rank > 30)
                            gameNode.children[6].children.push(game);
                        else if (game.score_rank > 20)
                            gameNode.children[7].children.push(game);
                        else if (game.score_rank > 10)
                            gameNode.children[8].children.push(game);
                        else
                            gameNode.children[9].children.push(game);

                    });
                }
            });

            var nodes = pack.nodes(gameNode);

            vis.selectAll("circle").remove();

            vis.selectAll("circle")
                    .data(nodes)
                    .enter().append("svg:circle")
                    .attr("class", function (d) {
                        return d.children ? "parent" : "child";
                    })
                    .attr("cx", function (d) {
                        return d.x;
                    })
                    .attr("cy", function (d) {
                        return d.y;
                    })
                    .attr("r", function (d) {
                        return d.r;
                    })
                    .style("opacity", 1)
                    .style("fill", function (d) {


                        // genre color
                        if (d.Category == "ACTION")
                            return actionColor;
                        else if (d.Category == "ADVENTURE")
                            return adventureColor;
                        else if (d.Category == "CASUAL")
                            return casualColor;
                        else if (d.Category == "INDIE")
                            return indieColor;
                        else if (d.Category == "MMO")
                            return mmoColor;
                        else if (d.Category == "RACING")
                            return racingColor;
                        else if (d.Category == "RPG")
                            return rpgColor;
                        else if (d.Category == "SIMULATION")
                            return simulationColor;
                        else if (d.Category == "SPORTS")
                            return sportsColor;
                        else if (d.Category == "STRATEGY")
                            return strategyColor;
                        else
                            return defaultColor;

                    })
                    .on("click", function (d) {
                        return zoom(node == d ? root : d);
                    });


            vis.selectAll("image").remove();

            vis.selectAll("image")
                    .data(nodes)
                    .enter().append("svg:image")
                    .attr("x", function (d) {
                        return d.x - d.r;
                    })
                    .attr("y", function (d) {
                        return d.y - d.r;
                    })
                    .attr("width", function (d) {
                        return d.r * 2;
                    })
                    .attr("height", function (d) {
                        return d.r * 2;
                    })
                    .style("opacity", function (d) {
                        return showIcons ? 1 : 0;

                    })
                    .attr("xlink:href", function (d) {


                        if (d.children)
                            return "";//http://store.akamai.steamstatic.com/public/shared/images/header/globalheader_logo.png";

                        if (d.Category == "ACTION")
                            return actionIcon;
                        else if (d.Category == "ADVENTURE")
                            return adventureIcon;
                        else if (d.Category == "CASUAL")
                            return casualIcon;
                        else if (d.Category == "INDIE")
                            return indieIcon;
                        else if (d.Category == "MMO")
                            return mmoIcon;
                        else if (d.Category == "RACING")
                            return racingIcon;
                        else if (d.Category == "RPG")
                            return rpgIcon;
                        else if (d.Category == "SIMULATION")
                            return simulationIcon;
                        else if (d.Category == "SPORTS")
                            return sportsIcon;
                        else if (d.Category == "STRATEGY")
                            return strategyIcon;
                        else
                            return "";

                        //return "http://cdn.akamai.steamstatic.com/steam/apps/" + d.appid + "/header.jpg";
                    })
                    .on("mouseover", function (d) {

                        if (d.children) // dont show outer bubbles
                            return;

                        tooltip.html("<div><h2>" + d.name
                                + "</h2><b>Developer: </b>" + d.developer
                                + "<br/><b>Genre: </b>" + d.Category
                                + "<br/><b>Publisher: </b>" + d.publisher
                                + "<br/><b>Score Ranking: </b>" + d.score_rank
                                + "<br/><b>Owners: </b>" + d.owners
                                + "<br/><b>Average Playtime (last 2 weeks): </b>" + (d.average_2weeks / 60).toFixed(2) + " hours"
                                + "<br/><b>Average Playtime (forever): </b>" + (d.average_forever / 60).toFixed(2) + " hours"
                                + "<br/><b>Players Forever: </b>" + d.players_forever
                                + "<br/><b>Concurrent Players Peak (yesterday): </b>" + d.ccu
                                + "<br/><b>SteamSpy ID: </b>" + d.appid
                                + " </div>");
                        tooltip.append("img")
                                .attr("src", "http://cdn.akamai.steamstatic.com/steam/apps/" + d.appid + "/header.jpg").attr("width", "230px")
                                .attr("height",
                                "107.5px");
                        tooltip.style("visibility", "visible");
                    })
                    .on("mousemove", function () {
                        return tooltip.style("top", ( d3.event.pageY - 10) + "px").style("left", (d3.event.pageX + 10) + "px");
                    })
                    .on("mouseout",
                    function () {
                        return tooltip.style("visibility",
                                "hidden");
                    })
                    .on("click",
                    function (d) {

                        var nodeToZoomOn;

                        if (d.depth == 2)
                            nodeToZoomOn = d.parent;
                        else
                            nodeToZoomOn = d;

                        if (node == nodeToZoomOn)
                            nodeToZoomOn = superRoot;


                        return zoom(nodeToZoomOn);

                        //return zoom(node == d ? superRoot : d);
                    });

            vis.selectAll("text").remove();

            vis.selectAll("text")
                    .data(nodes)
                    .enter().append("svg:text")
                    .attr("class",
                    function (d) {
                        return d.children ? "parent" :
                                "child";
                    })
                    .attr("x",
                    function (d) {
                        return d.x;
                    })
                    .attr("y",
                    function (d) {
                        return d.y;
                    })
                    .attr("dy", ".35em")
                    .attr("text-anchor", "middle")
                    .style("opacity",
                    function (d) {

                        return 1;
                    })

                    .text(
                    function (d) {

                        if (d.children)
                            return d.IntervalName;
                        else
                            return "";
                    });
            //d3.select(window).on("click", function() { zoom(root); });

    }


    function zoom(d, i) {

        var k = r / d.r / 2;
        x.domain([d.x - d.r, d.x + d.r]);
        y.domain([d.y - d.r, d.y + d.r]);

        var t = vis.transition()
                .duration(d3.event.altKey ? 7500 : 750);


        zoomLevel = d.depth;
        if (zoomLevel == 2) // don't zoom more in
            return;

        // console.log("new zoom node: " + d.name);
        //console.log("previous root node: " + root.name);
        //console.log("zoom level: " + zoomLevel);


        t.selectAll("circle")
                .attr("cx", function (d) {
                    return x(d.x);
                })
                .attr("cy", function (d) {
                    return y(d.y);
                })
                .attr("r", function (d) {
                    return k * d.r;
                });


        t.selectAll("text")
                .attr("x", function (d) {
                    return x(d.x);
                })
                .attr("y", function (d) {

                    // if (zoomLevel == 2)
                    //   return y(d.y - 40);
                    //else
                    return y(d.y);

                })
                .style("opacity",
                function (d) {
                    if (zoomLevel == 0)
                        return 1;
                    else
                        return 0;

                })
                .text(
                function (d) {

                    if (zoomLevel != 0)
                        return "";

                    if (d.children)
                        return d.IntervalName;
                    else
                        return "";
                });

        t.selectAll("image")

                .attr("width", function (d) {

                    if (zoomLevel == 2)
                        return k * d.r;
                    else
                        return k * d.r * 2;
                })
                .attr("height", function (d) {
                    if (zoomLevel == 2)
                        return k * d.r;
                    else
                        return k * d.r * 2;
                })
                .attr("x", function (d) {

                    if (zoomLevel == 2)
                        return x(d.x - d.r * 0.5);
                    else
                        return x(d.x - d.r);
                })
                .attr("y", function (d) {
                    if (zoomLevel == 2)
                        return y(d.y - d.r * 0.5);
                    else
                        return y(d.y - d.r);
                })
                .style("opacity", function (d) {

                    return showIcons ? 1 : 0;

                });


        root = d;
        node = d;
        d3.event.stopPropagation();
    }


    function HighlightCategories(d) {

        d3.selectAll(".filter_button").on("change", function () {

            var t = vis.transition()
                    .duration(750);

            var category = this.id;
            var checked = this.checked;

            if (category == "icons_button")
                showIcons = checked;

            //    return zoom(node == d ? root : d);

            if (category == "action_button")
                currentActionColor = (checked ? actionColor : notSelectedColor);
            else if (category == "adventure_button")
                currentAdventureColor = (checked ? adventureColor : notSelectedColor);
            else if (category == "casual_button")
                currentCasualColor = (checked ? casualColor : notSelectedColor);
            else if (category == "indie_button")
                currentIndieColor = (checked ? indieColor : notSelectedColor);
            else if (category == "mmo_button")
                currentMmoColor = (checked ? mmoColor : notSelectedColor);
            else if (category == "racing_button")
                currentRacingColor = (checked ? racingColor : notSelectedColor);
            else if (category == "rpg_button")
                currentRpgColor = (checked ? rpgColor : notSelectedColor);
            else if (category == "simulation_button")
                currentSimulationColor = (checked ? simulationColor : notSelectedColor);
            else if (category == "sports_button")
                currentSportsColor = (checked ? sportsColor : notSelectedColor);
            else if (category == "strategy_button")
                currentStrategyColor = (checked ? strategyColor : notSelectedColor);

            t.selectAll("circle")
                    .style("fill", function (d) {
                        //console.log("here2: ");
                        //console.log(d);

                        /*if (d.depth == 2)
                         return notSelectedColor;
                         */
                        // genre color
                        if (d.Category == "ACTION")
                            return currentActionColor;
                        else if (d.Category == "ADVENTURE")
                            return currentAdventureColor;
                        else if (d.Category == "CASUAL")
                            return currentCasualColor;
                        else if (d.Category == "INDIE")
                            return currentIndieColor;
                        else if (d.Category == "MMO")
                            return currentMmoColor;
                        else if (d.Category == "RACING")
                            return currentRacingColor;
                        else if (d.Category == "RPG")
                            return currentRpgColor;
                        else if (d.Category == "SIMULATION")
                            return currentSimulationColor;
                        else if (d.Category == "SPORTS")
                            return currentSportsColor;
                        else if (d.Category == "STRATEGY")
                            return currentStrategyColor;
                        else
                            return defaultColor;

                    });

            t.selectAll("image")
                    .style("opacity", function (d) {
                        return showIcons ? 1 : 0;
                    });
        });


    }

</script>


</body>
</html>